<html>
<head>
  <link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" />
	<style>
    html, body {width:100%; height:100%; padding: 0; margin: 0;}
    #map { width: 100%; height: 100%; background: black;}
	</style>
	<script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script>
	<script>
    var map;
    function main() {
      // initiate leaflet map
      map = new L.Map('map', {
        center: [49, -120],
        zoom: 4
      });
      L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', { attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attributions">CARTO</a>'}).addTo(map);
      var layerUrl = 'https://jontnc.carto.com/api/v2/viz/f528561c-68bf-11e6-a187-0e98b61680bf/viz.json';
      cartodb.createLayer(map, layerUrl)
        .addTo(map)
        .done(function(layer) {
          detectUserLocation();
        }).error(function() {
          //log the error
        });
      // credit: http://html5doctor.com/finding-your-position-with-geolocation/
      function detectUserLocation() {
        if(navigator.geolocation) {
          var timeoutVal = 10 * 1000 * 1000;
          navigator.geolocation.watchPosition(
            mapToPosition,
            alertError,
            { enableHighAccuracy: true, timeout: timeoutVal, maximumAge: 0 }
          );
        } else {
          alert("Geolocation is not supported by this browser");
        }
        function alertError(error) {
          var errors = {
            1: 'Permission denied',
            2: 'Position unavailable',
            3: 'Request timeout'
          };
          console.log("Error: " + errors[error.code]);
        }
      }
      function mapToPosition(position){
        lon = position.coords.longitude;
        lat = position.coords.latitude;
        // updateQuery();
        map.setView(new L.LatLng(lat,lon), 12);
        new L.CircleMarker([lat,lon],{radius: 4}).addTo(map);
      }
      var lon,
          lat,
          total = 10;
    }
    window.onload = main;
	</script>
</head>

<body>
  <div id='map'></div>
</body>
</html>